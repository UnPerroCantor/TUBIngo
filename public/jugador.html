<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>TUBIngo</title>
  <style>
    table {
      border-collapse: separate;
      border-width: thick;
      border-color: black;
      border-radius: 8%;
      aspect-ratio: 1 / 1;   /* <-- NUEVO: cuadrado siempre */
      margin: 20px auto;
      width: 95vw;           /* Hace la tabla casi tan ancha como la pantalla */
      max-width: 800px;      /* Limita el ancho máximo en pantallas grandes */
    }
    td {
      border: 1px solid black;
      width: 22vw;
      max-width: 150px;
      aspect-ratio: 1 / 1;   /* <-- NUEVO: cuadrado siempre */
      height: auto;          /* <-- NUEVO: deja que aspect-ratio controle */
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      padding: 5px;
      box-sizing: border-box;
      font-size: 4vw;
}
    @media (max-width: 500px) {
      table {
        max-width: 98vw;
      }
      td {
        width: 22vw;
        height: 22vw;
        max-width: none;
        max-height: none;
        font-size: 5vw;
      }
    }
    td.marcado {
      background-color: yellow;
    }
    #avisos {
      text-align: center;
      margin-top: 20px;
      font-size: 5vw;
      font-weight: bold;
      color: green;
    }
    .numero {
      font-weight: bold;
      font-size: 14px;
    }
    .momento {
      font-size: 14px;
      margin-top: 0px;
      display: block;
    }
  </style>
</head>
<body>
  <h1 style="text-align:center;">TUBIngo</h1>
  <h3 style="text-align:center;">Juguemos un Bingo de TUGO. Marcá los momentos que vayan apareciendo en vivo.</h3>
  <table id="carton"></table>
  <div id="avisos"></div>

  <script>
    let carton = [];
    let avisosMostrados = new Set();

    // Generar el cartón
    async function generarCarton() {
      const res = await fetch("momentos.json");
      const momentos = await res.json();
      const total = momentos.length;

      // Números de 1 a total
      const numeros = Array.from({ length: total }, (_, i) => i + 1);
      numeros.sort(() => Math.random() - 0.5);

      // Tomar los primeros 16
      carton = numeros.slice(0, 16);

      const tabla = document.getElementById("carton");
      let idx = 0;

      for (let i = 0; i < 4; i++) {
        const fila = document.createElement("tr");
        for (let j = 0; j < 4; j++) {
          const numero = carton[idx];
          const momento = momentos.find(m => m.numero === numero);

          const celda = document.createElement("td");
          celda.dataset.numero = numero;

          celda.innerHTML = `
            <span class="numero">${numero}</span>
            <span class="momento">${momento ? momento.momento : ""}</span>
          `;

          celda.addEventListener("click", () => {
            celda.classList.toggle("marcado");
            verificarBingo();
          });

          fila.appendChild(celda);
          idx++;
        }
        tabla.appendChild(fila);
      }
    }

    // Verificar bingo
    function verificarBingo() {
  const filas = document.querySelectorAll("#carton tr");
  const size = 4; // <-- Tamaño del cartón

  const ganadores = [];

    // Filas
    filas.forEach((fila, i) => {
      if ([...fila.children].every(td => td.classList.contains("marcado"))) {
        ganadores.push(`Bingo en fila ${i + 1}`);
      }
    });

    // Columnas
    for (let j = 0; j < size; j++) { // <-- Cambia 5 por size
      const col = [...filas].map(fila => fila.children[j]);
      if (col.every(td => td.classList.contains("marcado"))) {
        ganadores.push(`Bingo en columna ${j + 1}`);
      }
    }

    // Diagonales
    const diag1 = [...filas].map((fila, i) => fila.children[i]);
    if (diag1.every(td => td.classList.contains("marcado"))) {
      ganadores.push("Bingo en diagonal principal");
    }
    const diag2 = [...filas].map((fila, i) => fila.children[size - 1 - i]); // <-- Cambia 4 por size - 1
    if (diag2.every(td => td.classList.contains("marcado"))) {
      ganadores.push("Bingo en diagonal secundaria");
    }

    // Cartón lleno
    const todas = [...document.querySelectorAll("#carton td")];
    if (todas.every(td => td.classList.contains("marcado"))) {
      ganadores.push("¡Cartón lleno!");
    }

    mostrarAvisos(ganadores);
  }

    function mostrarAvisos(mensajes) {
      const avisosDiv = document.getElementById("avisos");
      mensajes.forEach(msg => {
        if (!avisosMostrados.has(msg)) {
          avisosMostrados.add(msg);
          const aviso = document.createElement("div");
          aviso.textContent = msg;
          avisosDiv.appendChild(aviso);
          setTimeout(() => {
            avisosDiv.removeChild(aviso);
            avisosMostrados.delete(msg);
          }, 5000);
        }
      });
    }

    generarCarton();
  </script>
</body>
</html>
